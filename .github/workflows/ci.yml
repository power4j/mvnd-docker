name: CI Build

on:
  push:
    branches: [ main, develop, master, dev ]
  pull_request:
    branches: [ main, develop, master, dev ]

env:
  MVND_VERSION: "1.0.2"
  TAG_VERSION: "dev"

jobs:
  test-temurin-8:
    name: Test JDK 8
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Build and test JDK 8 image
        uses: ./.github/workflows/docker-build.yml
        with:
          mvnd_version: ${{ env.MVND_VERSION }}
          tag_version: ${{ env.TAG_VERSION }}
          jdk_type: temurin-8-jdk-jammy
          base_image: eclipse-temurin:8-jdk-jammy
          platforms: linux/amd64
          push_image: false
          
  test-temurin-17:
    name: Test JDK 17
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Build and test JDK 17 image
        uses: ./.github/workflows/docker-build.yml
        with:
          mvnd_version: ${{ env.MVND_VERSION }}
          tag_version: ${{ env.TAG_VERSION }}
          jdk_type: temurin-17-jdk-jammy
          base_image: eclipse-temurin:17-jdk-jammy
          platforms: linux/amd64
          push_image: false

  test-temurin-22:
    name: Test JDK 22
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Build and test JDK 22 image
        uses: ./.github/workflows/docker-build.yml
        with:
          mvnd_version: ${{ env.MVND_VERSION }}
          tag_version: ${{ env.TAG_VERSION }}
          jdk_type: temurin-22-jdk-jammy
          base_image: eclipse-temurin:11-jdk-jammy
          platforms: linux/amd64
          push_image: false

